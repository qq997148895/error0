<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>{$Think.lang.appeal}</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/mui.min.css" />
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/base.css" />
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/public.css" />
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/appeal.css" />
		<script src="__PUBLIC__/Home/js/jquery-3.2.1.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="__PUBLIC__/Home/js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="__PUBLIC__/Home/js/flexible.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			// H5 plus事件处理
			function plusReady() {
				// 设置系统状态栏背景为红色
				plus.navigator.setStatusBarBackground('#409BFE');
                plus.navigator.setStatusBarStyle('light');
			}
			if(window.plus) {
				plusReady();
			} else {
				document.addEventListener('plusready', plusReady, false);
			}
		</script>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a href="/Home/Mymessage/myinfo" class="mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">{$Think.lang.appeal}</h1>
		</header>
		<div class="apeal">
			<input type="text" name="title" id="title" placeholder="{$Think.lang.reappeal}" />
			<textarea name="textarea" name="content" id="content" rows="" cols="" placeholder="{$Think.lang.p_mall}"></textarea>
			<div class="flexAround">
				<div class="addImg">
					<input type="hidden" name="erweima" id="erweima" value="">
					<img id="preview-img" src="/Public/Home/img/icon/add-5.png" style="width: 73px;height: 73px;margin: .1rem auto;">
					<input type="file" value="" id="upload" onchange="sa(this.id)" />
				</div>
				<div class="addImg">
					<input type="hidden" name="erweima2" id="erweima2" value="">
					<img id="preview-img2" src="/Public/Home/img/icon/add-5.png" style="width: 73px;height: 73px;margin: .1rem auto;">
					<input type="file" value="" id="upload2" onchange="sb(this.id)" />
				</div>
				<div class="addImg">
					<input type="hidden" name="erweima3" id="erweima3" value="">
					<img id="preview-img3" src="/Public/Home/img/icon/add-5.png" style="width: 73px;height: 73px;margin: .1rem auto;">
					<input type="file" value="" id="upload3" onchange="sc(this.id)" />
				</div>
			</div>

			<button id="save" onclick="save()" class="btn">{$Think.lang.sub}</button>
			<a href="/Home/Index/FeedbackList"><button id="list" class="btn" >反馈列表</button></a>
		</div>
		
		<!-- <div class="apeal">
			<form action="/Home/Index/Feedback" method="post">
				<input type="text" name="title" id="title" placeholder="请输入申诉原因" />
				<textarea name="textarea" name="content" id="content" rows="" cols="" placeholder="请详细描述问题"></textarea> 
				<input type="submit" class="btn" value="提交">
			</form>
		</div> -->
		<script type="text/javascript">
			//图一
			function sa(id){
				var fileObj = document.getElementById(id).files[0]; // 获取文件对象
				console.log(fileObj)
				var FileController = "{:U('Mymessage/upfile')}";                    // 接收上传文件的后台地址 
				// FormData 对象
				var form = new FormData();    //存储需要传递的参数
				// form.append("author", "竹叶科技");       //自定义数据
				// form.append("id",id);                       // 可以增加表单数据
				form.append(id, fileObj);                           // 文件对象
				// XMLHttpRequest 对象
				var xhr = new XMLHttpRequest();
				xhr.open("post", FileController, true);
				xhr.onload = function () {
				    var posit=this.responseText;
				    console.log(posit)
				    document.getElementById('erweima').value=posit;
				    var show=document.getElementById('preview-img');
				    show.src=posit;
				};
				xhr.send(form);
			};
			//图二
			function sb(id){
				var fileObj = document.getElementById(id).files[0]; // 获取文件对象
				console.log(fileObj)
				var FileController = "{:U('Mymessage/upfile')}";                    // 接收上传文件的后台地址 
				// FormData 对象
				var form = new FormData();    //存储需要传递的参数
				// form.append("author", "竹叶科技");       //自定义数据
				// form.append("id",id);                       // 可以增加表单数据
				form.append(id, fileObj);                           // 文件对象
				// XMLHttpRequest 对象
				var xhr = new XMLHttpRequest();
				xhr.open("post", FileController, true);
				xhr.onload = function () {
				    var posit2=this.responseText;
				    console.log(posit2)
				    document.getElementById('erweima2').value=posit2;
				    var show=document.getElementById('preview-img2');
				    show.src=posit2;
				};
				xhr.send(form);
			};
			//图三
			function sc(id){
				var fileObj = document.getElementById(id).files[0]; // 获取文件对象
				console.log(fileObj)
				var FileController = "{:U('Mymessage/upfile')}";                    // 接收上传文件的后台地址 
				// FormData 对象
				var form = new FormData();    //存储需要传递的参数
				// form.append("author", "竹叶科技");       //自定义数据
				// form.append("id",id);                       // 可以增加表单数据
				form.append(id, fileObj);                           // 文件对象
				// XMLHttpRequest 对象
				var xhr = new XMLHttpRequest();
				xhr.open("post", FileController, true);
				xhr.onload = function () {
				    var posit3=this.responseText;
				    console.log(posit3)
				    document.getElementById('erweima3').value=posit3;
				    var show=document.getElementById('preview-img3');
				    show.src=posit3;
				};
				xhr.send(form);
			};
			//提交
			function save() {
				var title = $("#title").val()
				var content = $("#content").val()
				var img1 = $("#erweima").val()
				console.log(img1);
				var img2 = $("#erweima2").val()
				console.log(img2);
				var img3 = $("#erweima3").val()
				console.log(img3);
				console.log(title)
				console.log(content)

				$.ajax({
					url: "/Home/Index/Feedback",
					type: "POST",
					data: {
						img1: img1,
						img2: img2,
						img3: img3,
						title: title,
						content: content
					},
					dataType: "json",
					success: function(str) {
						alert(str.message);
						window.location.reload();
					},
					error: function(err) {
						// console.log(err.statusText);
						// console.log('异常');
					}
				});

			}
		</script>
	</body>

</html>